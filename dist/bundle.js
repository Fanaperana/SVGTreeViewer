!function(){"use strict";class t{constructor(t){this.isPanning=!1,this.startX=0,this.startY=0,this.draggedNode=null,this.dragStartX=0,this.dragStartY=0,this.treeBounds={minX:0,minY:0,maxX:0,maxY:0},this.options={containerId:t.containerId,data:t.data||[],idAlias:t.idAlias||"id",parentIdAlias:t.parentIdAlias||"parent_id",collapseChild:t.collapseChild||!1,template:t.template||"<div class='node'>[data:text]</div>",nodeWidth:t.nodeWidth||160,nodeHeight:t.nodeHeight||100,nodePadding:t.nodePadding||40,levelHeight:t.levelHeight||150,horizontalSpacing:t.horizontalSpacing||200,backgroundPattern:t.backgroundPattern||"dots",backgroundColor:t.backgroundColor||"#f9f9f9",patternColor:t.patternColor||"#cccccc"},this.nodes=this._buildTree(),this.scale=1,this.panX=0,this.panY=0,this._renderSVG(),this._attachEvents(),this._renderTree(),this.centerTree()}_createDotPattern(){const t=document.createElementNS("http://www.w3.org/2000/svg","defs"),e=document.createElementNS("http://www.w3.org/2000/svg","pattern");e.setAttribute("id","dotPattern"),e.setAttribute("width","20"),e.setAttribute("height","20"),e.setAttribute("patternUnits","userSpaceOnUse");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");return n.setAttribute("cx","2"),n.setAttribute("cy","2"),n.setAttribute("r","0.5"),n.setAttribute("fill",this.options.patternColor),e.appendChild(n),t.appendChild(e),t}_createGridPattern(){const t=document.createElementNS("http://www.w3.org/2000/svg","defs"),e=document.createElementNS("http://www.w3.org/2000/svg","pattern");e.setAttribute("id","gridPattern"),e.setAttribute("width","20"),e.setAttribute("height","20"),e.setAttribute("patternUnits","userSpaceOnUse");const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","0"),n.setAttribute("y1","0"),n.setAttribute("x2","20"),n.setAttribute("y2","0"),n.setAttribute("stroke",this.options.patternColor),n.setAttribute("stroke-width","0.5"),n.setAttribute("stroke-dasharray","5, 5");const i=document.createElementNS("http://www.w3.org/2000/svg","line");return i.setAttribute("x1","0"),i.setAttribute("y1","0"),i.setAttribute("x2","0"),i.setAttribute("y2","20"),i.setAttribute("stroke",this.options.patternColor),i.setAttribute("stroke-width","0.5"),i.setAttribute("stroke-dasharray","5, 5"),e.appendChild(n),e.appendChild(i),t.appendChild(e),t}_applyBackgroundPattern(t){if("none"===this.options.backgroundPattern)return;let e,n;"dots"===this.options.backgroundPattern?(e=this._createDotPattern(),n="dotPattern"):(e=this._createGridPattern(),n="gridPattern"),t.appendChild(e);const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("fill",`url(#${n})`),t.appendChild(i)}_buildTree(){const t=new Map,{idAlias:e,parentIdAlias:n,data:i}=this.options,s=i.map((t=>({...t,id:t[e],parent_id:t[n],collapsed:!1,data:t,parent:null,children:[],manuallyPositioned:!1,current_node_element:document.createElementNS("http://www.w3.org/2000/svg","g"),parent_node_element:null,child_node_elements:[],isSelected:!1})));s.forEach((e=>t.set(e.id,e)));const o=[];return s.forEach((e=>{if(null==e.parent_id)e.parent=null,o.push(e);else{const n=t.get(e.parent_id);n&&(e.parent=n,e.parent_node_element=n.current_node_element,n.child_node_elements.push(e.current_node_element),n.children.push(e))}})),o}_renderActionButtons(t){const e=document.createElement("button"),n=document.createElement("button"),i=document.createElement("button"),s=document.createElement("button");e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zoom-in"><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/><line x1="11" x2="11" y1="8" y2="14"/><line x1="8" x2="14" y1="11" y2="11"/></svg>',n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zoom-out"><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/><line x1="8" x2="14" y1="11" y2="11"/></svg>',i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>',s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>',e.title="Zoom in",n.title="Zoom out",i.title="Reset view",s.title="Center tree",e.onmouseenter=()=>{e.style.opacity="0.9"},e.onmouseleave=()=>{e.style.opacity=".3"},n.onmouseenter=()=>{n.style.opacity="0.9"},n.onmouseleave=()=>{n.style.opacity=".3"},i.onmouseenter=()=>{i.style.opacity="0.9"},i.onmouseleave=()=>{i.style.opacity=".3"},s.onmouseenter=()=>{s.style.opacity="0.9"},s.onmouseleave=()=>{s.style.opacity=".3"},e.style.cssText="\n            margin: 4px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226, 0.5);\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n            color: black;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0.3;\n        ",n.style.cssText="\n            margin: 4px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226, 0.5);\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n            color: black;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0.3;\n        ",i.style.cssText="\n            margin: 4px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226, 0.5);\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n            color: black;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0.3;\n        ",s.style.cssText="\n            margin: 4px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226, 0.5);\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n            color: black;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0.3;\n        ",e.onclick=()=>{this.scale*=1.1,this._updateTransform()},n.onclick=()=>{this.scale/=1.1,this._updateTransform()},i.onclick=()=>{this.resetView()},s.onclick=()=>{this.centerTree()};const o=document.createElement("div");t.style.position="relative",o.style.cssText="\n            display: flex;\n            flex-direction: column;\n            gap: 5px;\n            justify-content: center;\n            width: 100%;\n            position: absolute;\n            top: 5px;\n            right: 5px;\n            width: 40px;\n            z-index: 100;\n            pointer-events: auto;\n            transition: opacity 0.3s ease-in-out, transform 0.3s ease;\n        ",o.append(e,n,i,s),t.append(o)}_renderSVG(){const t=document.getElementById(this.options.containerId);if(!t)throw new Error(`Container with ID "${this.options.containerId}" not found`);t.innerHTML="";const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.style.background=this.options.backgroundColor,this._applyBackgroundPattern(e),this._renderActionButtons(t),this.group=document.createElementNS("http://www.w3.org/2000/svg","g"),this.group.setAttribute("id","panZoomGroup"),e.appendChild(this.group),t.appendChild(e),this.svg=e}_attachEvents(){this.svg.addEventListener("mousedown",(t=>{const e=t.target;e.closest(".collapse-btn")||e.closest(".drag-handle")||(this.isPanning=!0,this.startX=t.clientX-this.panX,this.startY=t.clientY-this.panY)})),this.svg.addEventListener("mousemove",(t=>{if(this.draggedNode){const e=(t.clientX-this.dragStartX)/this.scale,n=(t.clientY-this.dragStartY)/this.scale;if(void 0!==this.draggedNode.x&&void 0!==this.draggedNode.y){this.draggedNode.manuallyPositioned=!0;const t=this.svg.querySelector(`[data-id="${this.draggedNode.id}"]`);t&&(this.draggedNode.x+=e,this.draggedNode.y+=n,t.setAttribute("transform",`translate(${this.draggedNode.x}, ${this.draggedNode.y})`),this._updateConnections(this.draggedNode))}return this.dragStartX=t.clientX,void(this.dragStartY=t.clientY)}this.isPanning&&(this.panX=t.clientX-this.startX,this.panY=t.clientY-this.startY,this._updateTransform())})),this.svg.addEventListener("mouseup",(()=>{this.isPanning=!1,this.draggedNode=null})),this.svg.addEventListener("mouseleave",(()=>{this.isPanning=!1,this.draggedNode=null})),this.svg.addEventListener("wheel",(t=>{t.preventDefault();const e=(t.deltaY>0?-1:1)>0?1.1:1/1.1,n=this.svg.getBoundingClientRect(),i=t.clientX-n.left,s=t.clientY-n.top,o=(i-this.panX)/this.scale,r=(s-this.panY)/this.scale;this.scale*=e,this.panX=i-o*this.scale,this.panY=s-r*this.scale,this._updateTransform()}))}_setupNodeDragging(t,e,n){n.addEventListener("mousedown",(n=>{n.stopPropagation(),n.preventDefault(),this.draggedNode=e,this.dragStartX=n.clientX,this.dragStartY=n.clientY,t.classList.add("dragging"),this.group.appendChild(t)})),e.children.length>0&&n.addEventListener("dblclick",(t=>{t.stopPropagation(),t.preventDefault(),e.collapsed=!e.collapsed,this._renderTree(),this.centerTree()}))}_createSCurve(t,e,n,i){const s=i-e;return`M ${t} ${e} C ${t} ${e+.5*s}, ${n} ${i-.5*s}, ${n} ${i}`}_updateConnections(t){const e=this._getAllNodes(this.nodes),n=new Map(e.map((t=>[t.id,t])));if(t.children.forEach((e=>{if(!t.collapsed){const n=this.svg.querySelector(`path[data-from="${t.id}"][data-to="${e.id}"]`);if(n){const i=this.options.nodeWidth/2,s=(t.x||0)+i,o=(t.y||0)+this.options.nodeHeight,r=(e.x||0)+i,d=e.y||0,a=this._createSCurve(s,o,r,d);n.setAttribute("d",a)}}})),t.parent_id){const e=n.get(t.parent_id);if(e&&!e.collapsed){const n=this.svg.querySelector(`path[data-from="${e.id}"][data-to="${t.id}"]`);if(n){const i=this.options.nodeWidth/2,s=(e.x||0)+i,o=(e.y||0)+this.options.nodeHeight,r=(t.x||0)+i,d=t.y||0,a=this._createSCurve(s,o,r,d);n.setAttribute("d",a)}}}}_getAllNodes(t){let e=[];const n=t=>{e.push(t),t.children.forEach(n)};return t.forEach(n),e}_updateTransform(){this.group.setAttribute("transform",`translate(${this.panX}, ${this.panY}) scale(${this.scale})`)}_renderTree(){this.group.innerHTML="";const t=this._layoutTree(this.nodes),e=new Map(t.map((t=>[t.id,t])));this._drawConnectionLines(t,e),this._drawNodes(t),this._updateTransform();const n=this._getAllNodes(this.nodes);this._calculateTreeBounds(n)}_drawConnectionLines(t,e){t.forEach((t=>{if(t.parent_id&&e.get(t.parent_id)){const n=e.get(t.parent_id);if(n&&!n.collapsed){const e=document.createElementNS("http://www.w3.org/2000/svg","path"),i=this.options.nodeWidth/2,s=(n.x||0)+i,o=(n.y||0)+this.options.nodeHeight,r=(t.x||0)+i,d=t.y||0,a=this._createSCurve(s,o,r,d);e.setAttribute("d",a),e.setAttribute("stroke","#ccc"),e.setAttribute("stroke-width","2"),e.setAttribute("fill","none"),e.setAttribute("data-from",String(n.id)),e.setAttribute("data-to",String(t.id)),this.group.appendChild(e)}}}))}_drawNodes(t){t.forEach((t=>{this._setupNodeGroup(t),this._setupNodeDragHandle(t),this._setupNodeContent(t),this.group.appendChild(t.current_node_element),this.options.nodeHeight<=0&&this._adjustNodeHeight(t)}))}_setupNodeGroup(t){t.current_node_element.setAttribute("class","node-group"),t.current_node_element.setAttribute("data-id",String(t.id)),t.current_node_element.setAttribute("transform",`translate(${t.x||0}, ${t.y||0})`)}_setupNodeDragHandle(t){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("width",String(this.options.nodeWidth)),e.setAttribute("height",String(this.options.nodeHeight)),e.setAttribute("fill","transparent"),e.setAttribute("class","drag-handle"),e.setAttribute("cursor","move"),t.current_node_element.appendChild(e),this._setupNodeDragging(t.current_node_element,t,e)}_setupNodeContent(t){const e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");e.setAttribute("width",String(this.options.nodeWidth)),e.setAttribute("height",String(this.options.nodeHeight));const n=document.createElement("div");n.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),n.innerHTML=this._processTemplate(this.options.template,t),n.style.cssText="\n        font-family: sans-serif;\n        background: white;\n        border: 1px solid #ccc;\n        border-radius: 6px;\n        padding: 10px;\n        box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n        width: 100%;\n        height: 100%;\n        box-sizing: border-box;\n        overflow: auto;\n        display: flex;\n        object-fit: contain;\n        flex-direction: column;\n        position: relative;\n        item-align: center;\n        justify-content: center;\n    ",this.options.collapseChild&&t.children.length>0&&this._addCollapseButton(t,n),e.appendChild(n),t.current_node_element.appendChild(e)}_addCollapseButton(t,e){const n=document.createElement("div");n.style.cssText="\n        display: flex;\n        justify-content: center;\n        width: 100%;\n    ";const i=document.createElement("button");i.className="collapse-btn",i.innerHTML=t.collapsed?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>':'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',i.title=t.collapsed?"Expand children":"Collapse children",i.style.cssText="\n        margin-top: 8px;\n        padding: 4px 6px;\n        font-size: 12px;\n        background:rgb(246, 238, 226);\n        color: black;\n        border: none;\n        border-radius: 4px;\n        cursor: pointer;\n    ",i.onclick=e=>{e.stopPropagation(),t.collapsed=!t.collapsed,this._renderTree()},n.appendChild(i),e.appendChild(n)}_adjustNodeHeight(t){const e=t.current_node_element.querySelector("div"),n=t.current_node_element.querySelector("foreignObject"),i=t.current_node_element.querySelector("rect");requestAnimationFrame((()=>{const t=e.getBoundingClientRect().height,s=Math.max(t,40);n.setAttribute("height",String(s)),i.setAttribute("height",String(s))}))}_calculateTreeBounds(t){if(0===t.length)return void(this.treeBounds={minX:0,minY:0,maxX:0,maxY:0});let e=1/0,n=1/0,i=-1/0,s=-1/0;t.forEach((t=>{void 0!==t.x&&(e=Math.min(e,t.x),i=Math.max(i,t.x+this.options.nodeWidth)),void 0!==t.y&&(n=Math.min(n,t.y),s=Math.max(s,t.y+this.options.nodeHeight))})),this.treeBounds={minX:e,minY:n,maxX:i,maxY:s}}_layoutTree(t){const{levelHeight:e,horizontalSpacing:n,nodePadding:i}=this.options;let s=[];const o=(t,i=0,r=0)=>{if(t.manuallyPositioned&&void 0!==t.x&&void 0!==t.y){let e=0;return t.collapsed||t.children.forEach((t=>{const n=o(t,i+1,r+e);e+=n.width})),s.push(t),{node:t,width:Math.max(n,e)}}if(!t.children.length||t.collapsed)return t.x=r,t.y=i*e,t.origX=r,t.origY=i*e,s.push(t),{node:t,width:n};let d=0;const a=[];for(const e of t.children){const t=o(e,i+1,r+d);a.push(t),d+=t.width}0===d&&(d=n);const h=a[0].node,l=a[a.length-1].node,c=h.x||0,p=c+((l.x||0)+this.options.nodeWidth-c)/2-this.options.nodeWidth/2;return t.x=p,t.y=i*e,t.origX=p,t.origY=i*e,s.push(t),{node:t,width:d}};let r=0;t.forEach((t=>{const e=o(t,0,r);r+=e.width+i}));const d=Math.min(...s.map((t=>t.x||0)));return d<0&&s.forEach((t=>{void 0!==t.x&&(t.x-=d),void 0!==t.origX&&(t.origX-=d)})),s}_processTemplate(t,e){return t.replace(/\[data:(.+?)\]/g,((t,n)=>{var i,s;return(null==(s=null==(i=e.data)?void 0:i.data)?void 0:s[n])??""}))}updateData(t){this.options.data=t,this.nodes=this._buildTree(),this._renderTree(),this.centerTree()}resetView(){this.scale=1,this.panX=50,this.panY=50,this._updateTransform()}resetNodePositions(){this._getAllNodes(this.nodes).forEach((t=>{t.manuallyPositioned=!1})),this._renderTree(),this.centerTree()}toggleNodeCollapse(t){const e=this._getAllNodes(this.nodes).find((e=>e.id===t));e&&(e.collapsed=!e.collapsed,this._renderTree(),this.centerTree())}centerTree(){const t=this.svg.getBoundingClientRect(),e=t.width,n=t.height,i=this.treeBounds.maxX-this.treeBounds.minX,s=this.treeBounds.maxY-this.treeBounds.minY,o=e/(i+100),r=n/(s+100);this.scale=Math.min(o,r,1),this.panX=(e-i*this.scale)/2-this.treeBounds.minX*this.scale,this.panY=(n-s*this.scale)/2-this.treeBounds.minY*this.scale,this._updateTransform()}zoomToFit(){const t=this._getAllNodes(this.nodes);if(0===t.length)return;let e=1/0,n=1/0,i=-1/0,s=-1/0;t.forEach((t=>{void 0!==t.x&&(e=Math.min(e,t.x),i=Math.max(i,t.x+160)),void 0!==t.y&&(n=Math.min(n,t.y),s=Math.max(s,t.y+90))})),e-=50,n-=50,i+=50,s+=50;const o=this.svg.getBoundingClientRect(),r=o.width,d=o.height,a=r/(i-e),h=d/(s-n);this.scale=Math.min(a,h,1),this.panX=(r-(i-e)*this.scale)/2-e*this.scale,this.panY=(d-(s-n)*this.scale)/2-n*this.scale,this._updateTransform()}}"undefined"!=typeof window&&(window.SVGTreeViewer=t)}();
