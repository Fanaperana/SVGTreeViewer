!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SVGTreeViewer=e():t.SVGTreeViewer=e()}(this,(()=>(()=>{"use strict";var t={};return{448:function(t,e){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)},r=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},i=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.SVGTreeViewer=void 0;var a=function(){function t(t){this.isPanning=!1,this.startX=0,this.startY=0,this.draggedNode=null,this.dragStartX=0,this.dragStartY=0,this.treeBounds={minX:0,minY:0,maxX:0,maxY:0},this.options={containerId:t.containerId,data:t.data||[],idAlias:t.idAlias||"id",parentIdAlias:t.parentIdAlias||"parent_id",collapseChild:t.collapseChild||!1,template:t.template||"<div class='node'>[data:text]</div>",nodeWidth:t.nodeWidth||160,nodeHeight:t.nodeHeight||100,nodePadding:t.nodePadding||40,levelHeight:t.levelHeight||150,horizontalSpacing:t.horizontalSpacing||200,backgroundPattern:t.backgroundPattern||"dots",backgroundColor:t.backgroundColor||"#f9f9f9",patternColor:t.patternColor||"#cccccc"},this.nodes=this._buildTree(),this.scale=1,this.panX=0,this.panY=0,this._renderSVG(),this._attachEvents(),this._renderTree(),this.centerTree()}return t.prototype._createDotPattern=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","defs"),e=document.createElementNS("http://www.w3.org/2000/svg","pattern");e.setAttribute("id","dotPattern"),e.setAttribute("width","20"),e.setAttribute("height","20"),e.setAttribute("patternUnits","userSpaceOnUse");var n=document.createElementNS("http://www.w3.org/2000/svg","circle");return n.setAttribute("cx","2"),n.setAttribute("cy","2"),n.setAttribute("r","1.0"),n.setAttribute("fill",this.options.patternColor),e.appendChild(n),t.appendChild(e),t},t.prototype._createGridPattern=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","defs"),e=document.createElementNS("http://www.w3.org/2000/svg","pattern");e.setAttribute("id","gridPattern"),e.setAttribute("width","20"),e.setAttribute("height","20"),e.setAttribute("patternUnits","userSpaceOnUse");var n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","0"),n.setAttribute("y1","0"),n.setAttribute("x2","20"),n.setAttribute("y2","0"),n.setAttribute("stroke",this.options.patternColor),n.setAttribute("stroke-width","0.5");var r=document.createElementNS("http://www.w3.org/2000/svg","line");return r.setAttribute("x1","0"),r.setAttribute("y1","0"),r.setAttribute("x2","0"),r.setAttribute("y2","20"),r.setAttribute("stroke",this.options.patternColor),r.setAttribute("stroke-width","0.5"),e.appendChild(n),e.appendChild(r),t.appendChild(e),t},t.prototype._applyBackgroundPattern=function(t){if("none"!==this.options.backgroundPattern){var e,n;"dots"===this.options.backgroundPattern?(e=this._createDotPattern(),n="dotPattern"):(e=this._createGridPattern(),n="gridPattern"),t.appendChild(e);var r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("fill","url(#".concat(n,")")),t.appendChild(r)}},t.prototype._buildTree=function(){var t=new Map,e=this.options,r=e.idAlias,o=e.parentIdAlias,i=e.data.map((function(t){return n(n({},t),{id:t[r],parent_id:t[o],children:[],collapsed:!1,data:t,manuallyPositioned:!1})}));i.forEach((function(e){return t.set(e.id,e)}));var a=[];return i.forEach((function(e){if(null==e.parent_id)a.push(e);else{var n=t.get(e.parent_id);n&&n.children.push(e)}})),a},t.prototype._renderActionButtons=function(t){var e=this,n=document.createElement("button"),r=document.createElement("button"),o=document.createElement("button"),i=document.createElement("button");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zoom-in"><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/><line x1="11" x2="11" y1="8" y2="14"/><line x1="8" x2="14" y1="11" y2="11"/></svg>',r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zoom-out"><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/><line x1="8" x2="14" y1="11" y2="11"/></svg>',o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>',i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>',n.title="Zoom in",r.title="Zoom out",o.title="Reset view",i.title="Center tree",n.onmouseenter=function(){n.style.opacity="0.9"},n.onmouseleave=function(){n.style.opacity=".3"},r.onmouseenter=function(){r.style.opacity="0.9"},r.onmouseleave=function(){r.style.opacity=".3"},o.onmouseenter=function(){o.style.opacity="0.9"},o.onmouseleave=function(){o.style.opacity=".3"},i.onmouseenter=function(){i.style.opacity="0.9"},i.onmouseleave=function(){i.style.opacity=".3"},n.style.cssText="\n            margin: 4px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226, 0.5);\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n            color: black;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0.3;\n        ",r.style.cssText="\n            margin: 4px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226, 0.5);\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n            color: black;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0.3;\n        ",o.style.cssText="\n            margin: 4px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226, 0.5);\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n            color: black;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0.3;\n        ",i.style.cssText="\n            margin: 4px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226, 0.5);\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n            color: black;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            opacity: 0.3;\n        ",n.onclick=function(){e.scale*=1.1,e._updateTransform()},r.onclick=function(){e.scale/=1.1,e._updateTransform()},o.onclick=function(){e.resetView()},i.onclick=function(){e.centerTree()};var a=document.createElement("div");t.style.position="relative",a.style.cssText="\n            display: flex; \n            flex-direction: column;\n            gap: 5px;\n            justify-content: center;\n            width: 100%;\n            position: absolute;\n            top: 5px;\n            right: 5px;\n            width: 40px;\n            z-index: 100;\n            pointer-events: auto;\n            transition: opacity 0.3s ease-in-out, transform 0.3s ease;\n        ",a.append(n,r,o,i),t.append(a)},t.prototype._renderSVG=function(){var t=document.getElementById(this.options.containerId);if(!t)throw new Error('Container with ID "'.concat(this.options.containerId,'" not found'));t.innerHTML="";var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.style.background=this.options.backgroundColor,this._applyBackgroundPattern(e),this._renderActionButtons(t),this.group=document.createElementNS("http://www.w3.org/2000/svg","g"),this.group.setAttribute("id","panZoomGroup"),e.appendChild(this.group),t.appendChild(e),this.svg=e},t.prototype._attachEvents=function(){var t=this;this.svg.addEventListener("mousedown",(function(e){var n=e.target;n.closest(".collapse-btn")||n.closest(".drag-handle")||(t.isPanning=!0,t.startX=e.clientX-t.panX,t.startY=e.clientY-t.panY)})),this.svg.addEventListener("mousemove",(function(e){if(t.draggedNode){var n=(e.clientX-t.dragStartX)/t.scale,r=(e.clientY-t.dragStartY)/t.scale;if(void 0!==t.draggedNode.x&&void 0!==t.draggedNode.y){t.draggedNode.manuallyPositioned=!0;var o=t.svg.querySelector('[data-id="'.concat(t.draggedNode.id,'"]'));o&&(t.draggedNode.x+=n,t.draggedNode.y+=r,o.setAttribute("transform","translate(".concat(t.draggedNode.x,", ").concat(t.draggedNode.y,")")),t._updateConnections(t.draggedNode))}return t.dragStartX=e.clientX,void(t.dragStartY=e.clientY)}t.isPanning&&(t.panX=e.clientX-t.startX,t.panY=e.clientY-t.startY,t._updateTransform())})),this.svg.addEventListener("mouseup",(function(){t.isPanning=!1,t.draggedNode=null})),this.svg.addEventListener("mouseleave",(function(){t.isPanning=!1,t.draggedNode=null})),this.svg.addEventListener("wheel",(function(e){e.preventDefault();var n=(e.deltaY>0?-1:1)>0?1.1:1/1.1,r=t.svg.getBoundingClientRect(),o=e.clientX-r.left,i=e.clientY-r.top,a=(o-t.panX)/t.scale,s=(i-t.panY)/t.scale;t.scale*=n,t.panX=o-a*t.scale,t.panY=i-s*t.scale,t._updateTransform()}))},t.prototype._setupNodeDragging=function(t,e,n){var r=this;n.addEventListener("mousedown",(function(n){n.stopPropagation(),n.preventDefault(),r.draggedNode=e,r.dragStartX=n.clientX,r.dragStartY=n.clientY,t.classList.add("dragging"),r.group.appendChild(t)})),e.children.length>0&&n.addEventListener("dblclick",(function(t){t.stopPropagation(),t.preventDefault(),e.collapsed=!e.collapsed,r._renderTree(),r.centerTree()}))},t.prototype._createSCurve=function(t,e,n,r){var o=r-e,i=t,a=e+.3*o,s=n,d=r-.3*o;return"M ".concat(t," ").concat(e," C ").concat(i," ").concat(a,", ").concat(s," ").concat(d,", ").concat(n," ").concat(r)},t.prototype._updateConnections=function(t){var e=this,n=this._getAllNodes(this.nodes),r=new Map(n.map((function(t){return[t.id,t]})));if(t.children.forEach((function(n){if(!t.collapsed){var r=e.svg.querySelector('path[data-from="'.concat(t.id,'"][data-to="').concat(n.id,'"]'));if(r){var o=e.options.nodeWidth/2,i=(t.x||0)+o,a=(t.y||0)+e.options.nodeHeight,s=(n.x||0)+o,d=n.y||0,c=e._createSCurve(i,a,s,d);r.setAttribute("d",c)}}})),t.parent_id){var o=r.get(t.parent_id);if(o&&!o.collapsed){var i=this.svg.querySelector('path[data-from="'.concat(o.id,'"][data-to="').concat(t.id,'"]'));if(i){var a=this.options.nodeWidth/2,s=(o.x||0)+a,d=(o.y||0)+this.options.nodeHeight,c=(t.x||0)+a,l=t.y||0,p=this._createSCurve(s,d,c,l);i.setAttribute("d",p)}}}},t.prototype._getAllNodes=function(t){var e=[],n=function(t){e.push(t),t.children.forEach(n)};return t.forEach(n),e},t.prototype._updateTransform=function(){this.group.setAttribute("transform","translate(".concat(this.panX,", ").concat(this.panY,") scale(").concat(this.scale,")"))},t.prototype._renderTree=function(){var t=this;this.group.innerHTML="";var e=this._layoutTree(this.nodes),n=new Map(e.map((function(t){return[t.id,t]})));e.forEach((function(e){if(e.parent_id&&n.get(e.parent_id)){var r=n.get(e.parent_id);if(r&&!r.collapsed){var o=document.createElementNS("http://www.w3.org/2000/svg","path"),i=t.options.nodeWidth/2,a=(r.x||0)+i,s=(r.y||0)+t.options.nodeHeight,d=(e.x||0)+i,c=e.y||0,l=t._createSCurve(a,s,d,c);o.setAttribute("d",l),o.setAttribute("stroke","#ccc"),o.setAttribute("stroke-width","2"),o.setAttribute("fill","none"),o.setAttribute("data-from",String(r.id)),o.setAttribute("data-to",String(e.id)),t.group.appendChild(o)}}})),e.forEach((function(e){var n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("class","node-group"),n.setAttribute("data-id",String(e.id)),n.setAttribute("transform","translate(".concat(e.x||0,", ").concat(e.y||0,")"));var r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("width",String(t.options.nodeWidth)),r.setAttribute("height",String(t.options.nodeHeight)),r.setAttribute("fill","transparent"),r.setAttribute("class","drag-handle"),r.setAttribute("cursor","move"),n.appendChild(r),t._setupNodeDragging(n,e,r);var o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");o.setAttribute("width",String(t.options.nodeWidth)),o.setAttribute("height",String(t.options.nodeHeight));var i=document.createElement("div");if(i.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),i.innerHTML=t._processTemplate(t.options.template,e),i.style.cssText="\n          font-family: sans-serif;\n          background: white;\n          border: 1px solid #ccc;\n          border-radius: 6px;\n          padding: 10px;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n          width: 100%;\n          height: 100%;\n          box-sizing: border-box;\n          overflow: auto;\n          display: flex;\n          object-fit: contain;\n          flex-direction: column;\n          position: relative;\n          item-align: center;\n          justify-content: center;\n        ",t.options.collapseChild&&e.children.length>0){var a=document.createElement("div");a.style.cssText="\n            display: flex; \n            justify-content: center;\n            width: 100%;\n        ";var s=document.createElement("button");s.className="collapse-btn",s.innerHTML=e.collapsed?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>':'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',s.title=e.collapsed?"Expand children":"Collapse children",s.style.cssText="\n            margin-top: 8px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(246, 238, 226);\n            color: black;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n          ",s.onclick=function(n){n.stopPropagation(),e.collapsed=!e.collapsed,t._renderTree()},a.appendChild(s),i.appendChild(a)}o.appendChild(i),n.appendChild(o),t.group.appendChild(n),t.options.nodeHeight<=0&&requestAnimationFrame((function(){var t=i.getBoundingClientRect().height,e=Math.max(t,40);o.setAttribute("height",String(e)),r.setAttribute("height",String(e))}))})),this._updateTransform();var r=this._getAllNodes(this.nodes);this._calculateTreeBounds(r)},t.prototype._calculateTreeBounds=function(t){var e=this;if(0!==t.length){var n=1/0,r=1/0,o=-1/0,i=-1/0;t.forEach((function(t){void 0!==t.x&&(n=Math.min(n,t.x),o=Math.max(o,t.x+e.options.nodeWidth)),void 0!==t.y&&(r=Math.min(r,t.y),i=Math.max(i,t.y+e.options.nodeHeight))})),this.treeBounds={minX:n,minY:r,maxX:o,maxY:i}}else this.treeBounds={minX:0,minY:0,maxX:0,maxY:0}},t.prototype._layoutTree=function(t){var e=this,n=this.options,a=n.levelHeight,s=n.horizontalSpacing,d=n.nodePadding,c=[],l=function(t,n,o){var i,d;if(void 0===n&&(n=0),void 0===o&&(o=0),t.manuallyPositioned&&void 0!==t.x&&void 0!==t.y){var p=0;return t.collapsed||t.children.forEach((function(t){var e=l(t,n+1,o+p);p+=e.width})),c.push(t),{node:t,width:Math.max(s,p)}}if(!t.children.length||t.collapsed)return t.x=o,t.y=n*a,t.origX=o,t.origY=n*a,c.push(t),{node:t,width:s};var u=0,h=[];try{for(var g=r(t.children),f=g.next();!f.done;f=g.next()){var v=f.value,m=l(v,n+1,o+u);h.push(m),u+=m.width}}catch(t){i={error:t}}finally{try{f&&!f.done&&(d=g.return)&&d.call(g)}finally{if(i)throw i.error}}0===u&&(u=s);var w=h[0].node,x=h[h.length-1].node,y=w.x||0,b=y+((x.x||0)+e.options.nodeWidth-y)/2-e.options.nodeWidth/2;return t.x=b,t.y=n*a,t.origX=b,t.origY=n*a,c.push(t),{node:t,width:u}},p=0;t.forEach((function(t){var e=l(t,0,p);p+=e.width+d}));var u=Math.min.apply(Math,i([],o(c.map((function(t){return t.x||0}))),!1));return u<0&&c.forEach((function(t){void 0!==t.x&&(t.x-=u),void 0!==t.origX&&(t.origX-=u)})),c},t.prototype._processTemplate=function(t,e){return t.replace(/\[data:(.+?)\]/g,(function(t,n){var r,o,i;return null!==(i=null===(o=null===(r=e.data)||void 0===r?void 0:r.data)||void 0===o?void 0:o[n])&&void 0!==i?i:""}))},t.prototype.updateData=function(t){this.options.data=t,this.nodes=this._buildTree(),this._renderTree(),this.centerTree()},t.prototype.resetView=function(){this.scale=1,this.panX=0,this.panY=0,this._updateTransform()},t.prototype.resetNodePositions=function(){this._getAllNodes(this.nodes).forEach((function(t){t.manuallyPositioned=!1})),this._renderTree(),this.centerTree()},t.prototype.toggleNodeCollapse=function(t){var e=this._getAllNodes(this.nodes).find((function(e){return e.id===t}));e&&(e.collapsed=!e.collapsed,this._renderTree(),this.centerTree())},t.prototype.centerTree=function(){var t=this.svg.getBoundingClientRect(),e=t.width,n=t.height,r=this.treeBounds.maxX-this.treeBounds.minX,o=this.treeBounds.maxY-this.treeBounds.minY,i=e/(r+100),a=n/(o+100);this.scale=Math.min(i,a,1),this.panX=(e-r*this.scale)/2-this.treeBounds.minX*this.scale,this.panY=(n-o*this.scale)/2-this.treeBounds.minY*this.scale,this._updateTransform()},t.prototype.zoomToFit=function(){var t=this._getAllNodes(this.nodes);if(0!==t.length){var e=1/0,n=1/0,r=-1/0,o=-1/0;t.forEach((function(t){void 0!==t.x&&(e=Math.min(e,t.x),r=Math.max(r,t.x+160)),void 0!==t.y&&(n=Math.min(n,t.y),o=Math.max(o,t.y+90))})),e-=50,n-=50,r+=50,o+=50;var i=this.svg.getBoundingClientRect(),a=i.width,s=i.height,d=a/(r-e),c=s/(o-n);this.scale=Math.min(d,c,1),this.panX=(a-(r-e)*this.scale)/2-e*this.scale,this.panY=(s-(o-n)*this.scale)/2-n*this.scale,this._updateTransform()}},t}();e.SVGTreeViewer=a}}[448](0,t),t.SVGTreeViewer})()));