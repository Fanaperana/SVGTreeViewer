!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SVGTreeViewer=e():t.SVGTreeViewer=e()}(this,(()=>(()=>{"use strict";var t={};return{448:function(t,e){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)},i=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a},o=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.SVGTreeViewer=void 0;var a=function(){function t(t){this.isPanning=!1,this.startX=0,this.startY=0,this.draggedNode=null,this.dragStartX=0,this.dragStartY=0,this.treeBounds={minX:0,minY:0,maxX:0,maxY:0},this.options={containerId:t.containerId,data:t.data||[],idAlias:t.idAlias||"id",parentIdAlias:t.parentIdAlias||"parent_id",collapseChild:t.collapseChild||!1,template:t.template||"<div class='node'>[data:text]</div>",nodeWidth:t.nodeWidth||160,nodeHeight:t.nodeHeight||100,nodePadding:t.nodePadding||40,levelHeight:t.levelHeight||150,horizontalSpacing:t.horizontalSpacing||200},this.nodes=this._buildTree(),this.scale=1,this.panX=0,this.panY=0,this._renderSVG(),this._attachEvents(),this._renderTree(),this.centerTree()}return t.prototype._buildTree=function(){var t=new Map,e=this.options,i=e.idAlias,r=e.parentIdAlias,o=e.data.map((function(t){return n(n({},t),{id:t[i],parent_id:t[r],children:[],collapsed:!1,data:t,manuallyPositioned:!1})}));o.forEach((function(e){return t.set(e.id,e)}));var a=[];return o.forEach((function(e){if(null==e.parent_id)a.push(e);else{var n=t.get(e.parent_id);n&&n.children.push(e)}})),a},t.prototype._renderSVG=function(){var t=document.getElementById(this.options.containerId);if(!t)throw new Error('Container with ID "'.concat(this.options.containerId,'" not found'));t.innerHTML="";var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","100%"),e.setAttribute("height","100%"),e.style.background="#f9f9f9",this.group=document.createElementNS("http://www.w3.org/2000/svg","g"),this.group.setAttribute("id","panZoomGroup"),e.appendChild(this.group),t.appendChild(e),this.svg=e},t.prototype._attachEvents=function(){var t=this;this.svg.addEventListener("mousedown",(function(e){var n=e.target;n.closest(".collapse-btn")||n.closest(".drag-handle")||(t.isPanning=!0,t.startX=e.clientX-t.panX,t.startY=e.clientY-t.panY)})),this.svg.addEventListener("mousemove",(function(e){if(t.draggedNode){var n=(e.clientX-t.dragStartX)/t.scale,i=(e.clientY-t.dragStartY)/t.scale;if(void 0!==t.draggedNode.x&&void 0!==t.draggedNode.y){t.draggedNode.manuallyPositioned=!0;var r=t.svg.querySelector('[data-id="'.concat(t.draggedNode.id,'"]'));r&&(t.draggedNode.x+=n,t.draggedNode.y+=i,r.setAttribute("transform","translate(".concat(t.draggedNode.x,", ").concat(t.draggedNode.y,")")),t._updateConnections(t.draggedNode))}return t.dragStartX=e.clientX,void(t.dragStartY=e.clientY)}t.isPanning&&(t.panX=e.clientX-t.startX,t.panY=e.clientY-t.startY,t._updateTransform())})),this.svg.addEventListener("mouseup",(function(){t.isPanning=!1,t.draggedNode=null})),this.svg.addEventListener("mouseleave",(function(){t.isPanning=!1,t.draggedNode=null})),this.svg.addEventListener("wheel",(function(e){e.preventDefault();var n=(e.deltaY>0?-1:1)>0?1.1:1/1.1,i=t.svg.getBoundingClientRect(),r=e.clientX-i.left,o=e.clientY-i.top,a=(r-t.panX)/t.scale,s=(o-t.panY)/t.scale;t.scale*=n,t.panX=r-a*t.scale,t.panY=o-s*t.scale,t._updateTransform()}))},t.prototype._setupNodeDragging=function(t,e,n){var i=this;n.addEventListener("mousedown",(function(n){n.stopPropagation(),n.preventDefault(),i.draggedNode=e,i.dragStartX=n.clientX,i.dragStartY=n.clientY,t.classList.add("dragging"),i.group.appendChild(t)})),e.children.length>0&&n.addEventListener("dblclick",(function(t){t.stopPropagation(),t.preventDefault(),e.collapsed=!e.collapsed,i._renderTree(),i.centerTree()}))},t.prototype._createSCurve=function(t,e,n,i){var r=i-e,o=t,a=e+.3*r,s=n,d=i-.3*r;return"M ".concat(t," ").concat(e," C ").concat(o," ").concat(a,", ").concat(s," ").concat(d,", ").concat(n," ").concat(i)},t.prototype._updateConnections=function(t){var e=this,n=this._getAllNodes(this.nodes),i=new Map(n.map((function(t){return[t.id,t]})));if(t.children.forEach((function(n){if(!t.collapsed){var i=e.svg.querySelector('path[data-from="'.concat(t.id,'"][data-to="').concat(n.id,'"]'));if(i){var r=e.options.nodeWidth/2,o=(t.x||0)+r,a=(t.y||0)+e.options.nodeHeight,s=(n.x||0)+r,d=n.y||0,c=e._createSCurve(o,a,s,d);i.setAttribute("d",c)}}})),t.parent_id){var r=i.get(t.parent_id);if(r&&!r.collapsed){var o=this.svg.querySelector('path[data-from="'.concat(r.id,'"][data-to="').concat(t.id,'"]'));if(o){var a=this.options.nodeWidth/2,s=(r.x||0)+a,d=(r.y||0)+this.options.nodeHeight,c=(t.x||0)+a,l=t.y||0,h=this._createSCurve(s,d,c,l);o.setAttribute("d",h)}}}},t.prototype._getAllNodes=function(t){var e=[],n=function(t){e.push(t),t.children.forEach(n)};return t.forEach(n),e},t.prototype._updateTransform=function(){this.group.setAttribute("transform","translate(".concat(this.panX,", ").concat(this.panY,") scale(").concat(this.scale,")"))},t.prototype._renderTree=function(){var t=this;this.group.innerHTML="";var e=this._layoutTree(this.nodes),n=new Map(e.map((function(t){return[t.id,t]})));e.forEach((function(e){if(e.parent_id&&n.get(e.parent_id)){var i=n.get(e.parent_id);if(i&&!i.collapsed){var r=document.createElementNS("http://www.w3.org/2000/svg","path"),o=t.options.nodeWidth/2,a=(i.x||0)+o,s=(i.y||0)+t.options.nodeHeight,d=(e.x||0)+o,c=e.y||0,l=t._createSCurve(a,s,d,c);r.setAttribute("d",l),r.setAttribute("stroke","#ccc"),r.setAttribute("stroke-width","2"),r.setAttribute("fill","none"),r.setAttribute("data-from",String(i.id)),r.setAttribute("data-to",String(e.id)),t.group.appendChild(r)}}})),e.forEach((function(e){var n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("class","node-group"),n.setAttribute("data-id",String(e.id)),n.setAttribute("transform","translate(".concat(e.x||0,", ").concat(e.y||0,")"));var i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("width",String(t.options.nodeWidth)),i.setAttribute("height",String(t.options.nodeHeight)),i.setAttribute("fill","transparent"),i.setAttribute("class","drag-handle"),i.setAttribute("cursor","move"),n.appendChild(i),t._setupNodeDragging(n,e,i);var r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");r.setAttribute("width",String(t.options.nodeWidth)),r.setAttribute("height",String(t.options.nodeHeight));var o=document.createElement("div");if(o.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),o.innerHTML=t._processTemplate(t.options.template,e),o.style.cssText="\n          font-family: sans-serif;\n          background: white;\n          border: 1px solid #ccc;\n          border-radius: 6px;\n          padding: 10px;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n          width: 100%;\n          height: 100%;\n          box-sizing: border-box;\n          overflow: auto;\n          display: flex;\n          object-fit: contain;\n          flex-direction: column;\n          position: relative;\n          item-align: center;\n          justify-content: center;\n        ",t.options.collapseChild&&e.children.length>0){var a=document.createElement("div");a.style.cssText="\n            display: flex; \n            justify-content: center;\n            width: 100%;\n        ";var s=document.createElement("button");s.className="collapse-btn",s.innerHTML=e.collapsed?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>':'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',s.title=e.collapsed?"Expand children":"Collapse children",s.style.cssText="\n            margin-top: 8px;\n            padding: 4px 6px;\n            font-size: 12px;\n            background:rgb(37, 36, 36);\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n          ",s.onclick=function(n){n.stopPropagation(),e.collapsed=!e.collapsed,t._renderTree()},a.appendChild(s),o.appendChild(a)}r.appendChild(o),n.appendChild(r),t.group.appendChild(n),t.options.nodeHeight<=0&&requestAnimationFrame((function(){var t=o.getBoundingClientRect().height,e=Math.max(t,40);r.setAttribute("height",String(e)),i.setAttribute("height",String(e))}))})),this._updateTransform();var i=this._getAllNodes(this.nodes);this._calculateTreeBounds(i)},t.prototype._calculateTreeBounds=function(t){var e=this;if(0!==t.length){var n=1/0,i=1/0,r=-1/0,o=-1/0;t.forEach((function(t){void 0!==t.x&&(n=Math.min(n,t.x),r=Math.max(r,t.x+e.options.nodeWidth)),void 0!==t.y&&(i=Math.min(i,t.y),o=Math.max(o,t.y+e.options.nodeHeight))})),this.treeBounds={minX:n,minY:i,maxX:r,maxY:o}}else this.treeBounds={minX:0,minY:0,maxX:0,maxY:0}},t.prototype._layoutTree=function(t){var e=this,n=this.options,a=n.levelHeight,s=n.horizontalSpacing,d=n.nodePadding,c=[],l=function(t,n,r){var o,d;if(void 0===n&&(n=0),void 0===r&&(r=0),t.manuallyPositioned&&void 0!==t.x&&void 0!==t.y){var h=0;return t.collapsed||t.children.forEach((function(t){var e=l(t,n+1,r+h);h+=e.width})),c.push(t),{node:t,width:Math.max(s,h)}}if(!t.children.length||t.collapsed)return t.x=r,t.y=n*a,t.origX=r,t.origY=n*a,c.push(t),{node:t,width:s};var p=0,u=[];try{for(var g=i(t.children),f=g.next();!f.done;f=g.next()){var v=f.value,m=l(v,n+1,r+p);u.push(m),p+=m.width}}catch(t){o={error:t}}finally{try{f&&!f.done&&(d=g.return)&&d.call(g)}finally{if(o)throw o.error}}0===p&&(p=s);var y=u[0].node,w=u[u.length-1].node,x=y.x||0,b=x+((w.x||0)+e.options.nodeWidth-x)/2-e.options.nodeWidth/2;return t.x=b,t.y=n*a,t.origX=b,t.origY=n*a,c.push(t),{node:t,width:p}},h=0;t.forEach((function(t){var e=l(t,0,h);h+=e.width+d}));var p=Math.min.apply(Math,o([],r(c.map((function(t){return t.x||0}))),!1));return p<0&&c.forEach((function(t){void 0!==t.x&&(t.x-=p),void 0!==t.origX&&(t.origX-=p)})),c},t.prototype._processTemplate=function(t,e){return t.replace(/\[data:(.+?)\]/g,(function(t,n){var i,r,o;return null!==(o=null===(r=null===(i=e.data)||void 0===i?void 0:i.data)||void 0===r?void 0:r[n])&&void 0!==o?o:""}))},t.prototype.updateData=function(t){this.options.data=t,this.nodes=this._buildTree(),this._renderTree(),this.centerTree()},t.prototype.resetView=function(){this.scale=1,this.panX=0,this.panY=0,this._updateTransform()},t.prototype.resetNodePositions=function(){this._getAllNodes(this.nodes).forEach((function(t){t.manuallyPositioned=!1})),this._renderTree(),this.centerTree()},t.prototype.toggleNodeCollapse=function(t){var e=this._getAllNodes(this.nodes).find((function(e){return e.id===t}));e&&(e.collapsed=!e.collapsed,this._renderTree(),this.centerTree())},t.prototype.centerTree=function(){var t=this.svg.getBoundingClientRect(),e=t.width,n=t.height,i=this.treeBounds.maxX-this.treeBounds.minX,r=this.treeBounds.maxY-this.treeBounds.minY,o=e/(i+100),a=n/(r+100);this.scale=Math.min(o,a,1),this.panX=(e-i*this.scale)/2-this.treeBounds.minX*this.scale,this.panY=(n-r*this.scale)/2-this.treeBounds.minY*this.scale,this._updateTransform()},t.prototype.zoomToFit=function(){var t=this._getAllNodes(this.nodes);if(0!==t.length){var e=1/0,n=1/0,i=-1/0,r=-1/0;t.forEach((function(t){void 0!==t.x&&(e=Math.min(e,t.x),i=Math.max(i,t.x+160)),void 0!==t.y&&(n=Math.min(n,t.y),r=Math.max(r,t.y+90))})),e-=50,n-=50,i+=50,r+=50;var o=this.svg.getBoundingClientRect(),a=o.width,s=o.height,d=a/(i-e),c=s/(r-n);this.scale=Math.min(d,c,1),this.panX=(a-(i-e)*this.scale)/2-e*this.scale,this.panY=(s-(r-n)*this.scale)/2-n*this.scale,this._updateTransform()}},t}();e.SVGTreeViewer=a}}[448](0,t),t.SVGTreeViewer})()));